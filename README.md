# ë‚˜ë§Œì˜ ì›¹ ì„œë²„ ë§Œë“¤ê¸°

## ğŸ”— ë§í¬
**ë¸”ë¡œê·¸** : https://velog.io/@dlwodbs1223/woowacourse-precourse-open-mission

**ë…¸ì…˜** : https://www.notion.so/2b5803528be780029eefd8e5fd3a2298?source=copy_link

## ğŸ“Œ ì„¤ëª…
ì´ í”„ë¡œì íŠ¸ëŠ” Javaì˜ Socket APIë§Œì„ ì‚¬ìš©í•˜ì—¬, SpringBootë‚˜ Tomcat ê°™ì€ 
í”„ë ˆì„ì›Œí¬/ì»¨í…Œì´ë„ˆ ì—†ì´ HTTP ì›¹ ì„œë²„ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ëŠ” ë„ì „ ê³¼ì œì…ë‹ˆë‹¤.

ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ í”„ë¦¬ì½”ìŠ¤ ë§ˆì§€ë§‰ ì˜¤í”ˆ ë¯¸ì…˜ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìœ¼ë©°, 'ê²°ê³¼ë³´ë‹¤ëŠ” ê³¼ì •', 
'ì‹¤íŒ¨ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠëŠ” ëª°ì…'ì„ ëª©í‘œë¡œ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° TDD(í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ)ë¥¼ í†µí•´ ë‹¨ë‹¨í•œ ì„¤ê³„ë¥¼ í•˜ê³ , 
ìŠ¤ë ˆë“œ í’€(Thread Pool)ì„ ë„ì…í•˜ì—¬ ë™ì‹œì„± ì´ìŠˆë¥¼ í•´ê²°í•˜ëŠ” ë“± ì•ˆì •ì ì¸ ì„œë²„ë¥¼ ë§Œë“¤ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.

## ğŸ’¡ ê³„ê¸°
> "SpringBoot ë‚´ë¶€ì—ì„œ ë™ì‘í•˜ëŠ” ì›¹ ì„œë²„ëŠ” ë„ëŒ€ì²´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì„ ë°›ì•„ì„œ ì²˜ë¦¬í• ê¹Œ?"

í‰ì†Œ SpringBootë¥¼ í†µí•´ ê°œë°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ì„œ SpringBootê°€ ì œê³µí•˜ëŠ” ì›¹ ì„œë²„ì— ëŒ€í•´ ê¶ê¸ˆí•´ì¡ŒìŠµë‹ˆë‹¤.
ë„¤íŠ¸ì›Œí¬ì™€ HTTPì˜ ë³¸ì§ˆì„ ì´í•´í•˜ê³ ì ì‹œì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ¯ ëª©í‘œ
- [x] TCP ì†Œì¼“ ì„œë²„ êµ¬í˜„ : `ServerSocket`ì„ ì´ìš©í•œ í¬íŠ¸ ë°”ì¸ë”© ë° ì—°ê²°
- [x] HTTP ìš”ì²­ ë¼ì¸/í—¤ë” íŒŒì‹± : RequestLine(Method, Path), Headers íŒŒì‹± ë¡œì§ êµ¬í˜„
- [x] ë¼ìš°íŒ… ë° ê¸°ë³¸ í•¸ë“¤ëŸ¬ : ìš”ì²­ URLì— ë”°ë¥¸ ë™ì  ë¶„ê¸° ì²˜ë¦¬
- [x] ì •ì  íŒŒì¼ ì„œë¹™ : `/index.html`ê°™ì€ ë¦¬ì†ŒìŠ¤ íŒŒì¼ ì½ê¸° ë° ì‘ë‹µ
- [x] ì—ëŸ¬ ì²˜ë¦¬ : ì˜ëª»ëœ ìš”ì²­ ë° ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ì— ëŒ€í•œ `404 Not Found` ì²˜ë¦¬ 
- [x] ë©€í‹°ìŠ¤ë ˆë“œ ì²˜ë¦¬ : `ExecutorService`ë¥¼ í™œìš©í•œ ìŠ¤ë ˆë“œ í’€ ì ìš©

## ğŸ“œ ìƒì„¸ êµ¬í˜„ ê¸°ëŠ¥ ëª©ë¡
### ì›¹ ì„œë²„ ì¸í”„ë¼ (Infrastructure)

- TCP ì†Œì¼“ ì„œë²„ êµ¬ë™
  - ServerSocketì„ ì‚¬ìš©í•˜ì—¬ 8080 í¬íŠ¸ ë°”ì¸ë”© ë° ì—°ê²° ëŒ€ê¸°
  - í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì‹œ ì ‘ì† ì •ë³´(IP) ë¡œê¹…

- ë™ì‹œì„± ì œì–´ (Concurrency)
  - ExecutorServiceë¥¼ ì‚¬ìš©í•œ ìŠ¤ë ˆë“œ í’€ êµ¬í˜„
  - ë™ì‹œ ì ‘ì† ì²˜ë¦¬ë¥¼ ìœ„í•œ ìŠ¤ë ˆë“œ ê°œìˆ˜ ì œí•œ
  - ì„œë²„ ì¢…ë£Œ ì‹œ ìŠ¤ë ˆë“œ í’€ ìì› í•´ì œ

### HTTP í”„ë¡œí† ì½œ ì²˜ë¦¬ (HTTP Protocol)

- HTTP ìš”ì²­(Request) íŒŒì‹±
  - InputStreamì„ í†µí•´ ë“¤ì–´ì˜¤ëŠ” ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
  - Start Line íŒŒì‹±: HTTP Method(GET ë“±), URL Path, Version ì¶”ì¶œ ë° ê²€ì¦
  - Header íŒŒì‹±: ë¹ˆ ì¤„ì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ í—¤ë”ë¥¼ ì½ì–´ Mapìœ¼ë¡œ ì €ì¥
  - ìœ íš¨í•˜ì§€ ì•Šì€ ìš”ì²­(null, empty, ì˜ëª»ëœ í¬ë§·)ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬

- HTTP ì‘ë‹µ(Response) ìƒì„±
  - ìƒíƒœ ì½”ë“œ(200, 404)ì— ë”°ë¥¸ Status Line ìƒì„±
  - Content-Type, Content-Length ë“± í•„ìˆ˜ í—¤ë” ì„¤ì •
  - HTML ë³¸ë¬¸(Body) ë°ì´í„° ì²˜ë¦¬ ë° ì „ì†¡

### ìš”ì²­ ì²˜ë¦¬ ë° ë¼ìš°íŒ… (Controller)

- í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ ì ìš© (RequestHandler)
  - ëª¨ë“  ìš”ì²­ì„ ë°›ì•„ ì ì ˆí•œ ë¡œì§ìœ¼ë¡œ ë¶„ê¸° ì²˜ë¦¬

- URL ê¸°ë°˜ ë¼ìš°íŒ…
  - GET / ìš”ì²­ ì‹œ "Hello World" ë™ì  HTML ì‘ë‹µ
  - ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ë¡œ ìš”ì²­ ì‹œ 404 Not Found í˜ì´ì§€ ì‘ë‹µ

- ì •ì  íŒŒì¼ ì„œë¹™ (Static File Serving)
  - ìš”ì²­ ê²½ë¡œê°€ .htmlë¡œ ëë‚  ê²½ìš° src/main/resources/static ê²½ë¡œ íƒìƒ‰
  - íŒŒì¼ ì¡´ì¬ ì‹œ í•´ë‹¹ íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ ì‘ë‹µ ë³¸ë¬¸ì— í¬í•¨
  - íŒŒì¼ ë¯¸ì¡´ì¬ ì‹œ 404 ì‘ë‹µ ì²˜ë¦¬

### ì•ˆì •ì„± ë° ìœ í‹¸ë¦¬í‹° (Stability & Utils)

- ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
  - try-with-resourcesë¥¼ í™œìš©í•˜ì—¬ ì‘ë‹µ ì „ì†¡ í›„ Socket ë° I/O Stream ìë™ ì¢…ë£Œ
  - ì˜ˆì™¸ ì²˜ë¦¬ ë° ë¡œê¹…
  - OutputViewë¥¼ í†µí•œ ì„œë²„ ìƒíƒœ ë° ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥ ë¶„ë¦¬
  - ì»¤ìŠ¤í…€ ì˜ˆì™¸ ë©”ì‹œì§€(ErrorMessage) ìƒìˆ˜í™” ê´€ë¦¬

### í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (Testing)
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)
  - HttpRequest íŒŒì‹± ë¡œì§ ê²€ì¦ (StartLine, Header)
  - HttpResponse ì‘ë‹µ í¬ë§· ê²€ì¦
  - RequestHandler ë¼ìš°íŒ… ë° íŒŒì¼ ì„œë¹™ ë¡œì§ ê²€ì¦

- ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬ êµ¬í˜„ (Load Test)
  - ConcurrentLoadTest í´ë˜ìŠ¤ ìì²´ êµ¬í˜„
  - CountDownLatchë¥¼ í™œìš©í•œ ë™ì‹œ ì ‘ì† ì‹œë‚˜ë¦¬ì˜¤(20ëª…) ì¬í˜„
  - ì‘ë‹µ ì„±ê³µë¥  ë° ì„œë²„ ì•ˆì •ì„± ê²€ì¦ ë¦¬í¬íŠ¸ ì¶œë ¥

## ğŸ”„ íë¦„
MVC íŒ¨í„´ê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¡œ ì—­í• ì„ ë¶„ë¦¬í•˜ì—¬ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.
```
Client  ->  WebServer (Port 8080)
                â†“
           (Thread Pool)
                â†“
           RequestHandler (Controller)
            â†™        â†˜
     HttpRequest    HttpResponse
```

1. Clientê°€ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
2. WebServerê°€ ì—°ê²°ì„ ìˆ˜ë½í•˜ê³  Thread Poolì—ì„œ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ í• ë‹¹í•©ë‹ˆë‹¤.
3. RequestHandlerê°€ ì‹¤í–‰ë˜ë©° HttpRequestë¥¼ í†µí•´ ë°ì´í„°ë¥¼ íŒŒì‹±í•©ë‹ˆë‹¤.
4. íŒŒì‹±ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¼ìš°íŒ… ë¡œì§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
5. HttpResponseë¥¼ í†µí•´ ê·œê²©ì— ë§ëŠ” HTTP ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.


## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì¡°
```
src
â”œâ”€main
â”‚  â”œâ”€java
â”‚  â”‚  â””â”€mywebserver
â”‚  â”‚      â”‚  Application.java
â”‚  â”‚      â”‚  WebServer.java
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€controller
â”‚  â”‚      â”‚      RequestHandler.java
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€http
â”‚  â”‚      â”‚      HttpHeaders.java
â”‚  â”‚      â”‚      HttpMethod.java
â”‚  â”‚      â”‚      HttpRequest.java
â”‚  â”‚      â”‚      HttpResponse.java
â”‚  â”‚      â”‚      HttpStartLine.java
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€util
â”‚  â”‚      â”‚      ErrorMessage.java
â”‚  â”‚      â”‚
â”‚  â”‚      â””â”€view
â”‚  â”‚              OutputView.java
â”‚  â”‚
â”‚  â””â”€resources
â”‚      â””â”€static
â”‚              index.html
â”‚
â””â”€test
    â””â”€java
        â””â”€mywebserver
            â”‚  ConcurrentLoadTest.java
            â”‚
            â”œâ”€controller
            â”‚      RequestHandlerTest.java
            â”‚
            â””â”€http
                    HttpHeadersTest.java
                    HttpRequestTest.java
                    HttpResponseTest.java

```

## ğŸƒ ì‹¤í–‰ ë°©ë²•
1. Application.main()ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. http://localhost:8080 ì— ì ‘ì†í•©ë‹ˆë‹¤.
3. `Hello World` ë¬¸êµ¬ê°€ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
4. http://localhost:8080/index.html ì— ì ‘ì†í•©ë‹ˆë‹¤.
5. `Hello File` ë¬¸êµ¬ê°€ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
6. http://localhost:8080/abc (abcë§ê³  ë‹¤ë¥¸ ê²ƒë„ ê°€ëŠ¥)ì— ì ‘ì†í•©ë‹ˆë‹¤.
7. `404 Not Found` ë¬¸êµ¬ê°€ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
ì´ í”„ë¡œì íŠ¸ëŠ” ê¸°ëŠ¥ ê²€ì¦ì„ ìœ„í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ ì„œë²„ ì•ˆì •ì„± ê²€ì¦ì„ ìœ„í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)

HttpHeaders, HttpRequest, HttpResponse, RequestHandlerì˜ ë¡œì§ì„ TDDë¡œ ê²€ì¦.

#### í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰
```
./gradlew clean test
```

* ë¹Œë“œ ê²°ê³¼ëŠ” build/reports/tests/test/index.htmlì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. ë¶€í•˜ í…ŒìŠ¤íŠ¸ (Load Test)

ì§ì ‘ êµ¬í˜„í•œ ConcurrentLoadTest ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬, ë‹¤ìˆ˜ì˜ ì‚¬ìš©ìê°€ ë™ì‹œì— ì ‘ì†í•  ë•Œ ì„œë²„ê°€ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.

#### ì‹¤í–‰ ì ˆì°¨
1. ì„œë²„ ì‹¤í–‰: ë¨¼ì € Application.main()ì„ ì‹¤í–‰í•˜ì—¬ ì›¹ ì„œë²„ë¥¼ ì¼­ë‹ˆë‹¤.
2. í…ŒìŠ¤íŠ¸ ë„êµ¬ ì‹¤í–‰: ì„œë²„ê°€ ì¼œì§„ ìƒíƒœì—ì„œ src/test/java/webserver/ConcurrentLoadTest.javaì˜ main() ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

#### ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤
- ë™ì‹œ ì ‘ì†: 20ëª…ì˜ ì‚¬ìš©ìê°€ ë™ì‹œì— ìš”ì²­ì„ ì‹œë„í•©ë‹ˆë‹¤.
- ì´ ìš”ì²­: ì´ 100ê°œì˜ HTTP GET ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
- ê²€ì¦ í•­ëª©:
  - ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ `200 OK` ì‘ë‹µì„ ë°›ì•˜ëŠ”ê°€?
  - ë™ì‹œ ì ‘ì† ìƒí™©ì—ì„œë„ ì„œë²„ê°€ ì¤‘ë‹¨ë˜ê±°ë‚˜ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ê°€?

#### ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ
```
========================================
ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸
========================================
ì´ ì†Œìš” ì‹œê°„    : 141 ms
ì„±ê³µ ìš”ì²­       : 100
ì‹¤íŒ¨ ìš”ì²­       : 0
========================================
[PASS] ì„œë²„ê°€ ëª¨ë“  ìš”ì²­ì„ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤!
```